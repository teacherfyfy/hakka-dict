<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢èªå°å­—å…¸ (Hakka Helper)</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div class="container">
        <header>
            <h1>å®¢èªå°å­—å…¸</h1>
            <p>è¼¸å…¥è¯èªï¼ŒæŸ¥è©¢å®¢èªèªªæ³• (è³‡æ–™ä¾†æºï¼šèŒå…¸)</p>
        </header>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="ä¾‹å¦‚ï¼šè€å¸«ã€è˜‹æœã€å­¸æ ¡..." autocomplete="off">
            <button onclick="searchHakka()">
                <i class="fas fa-search"></i> æœå°‹
            </button>
        </div>

        <div id="loading" class="hidden">
            <div class="spinner"></div>
            <p>æ­£åœ¨ç¿»å­—å…¸...</p>
        </div>

        <div id="resultArea">
            </div>
    </div>

    <script>
        // æ ¸å¿ƒç¨‹å¼ç¢¼ï¼šé€£æ¥èŒå…¸ API
        async function searchHakka() {
            const input = document.getElementById('searchInput').value.trim();
            const resultArea = document.getElementById('resultArea');
            const loading = document.getElementById('loading');

            if (!input) return;

            // æ¸…ç©ºèˆŠçµæœä¸¦é¡¯ç¤ºè¼‰å…¥ä¸­
            resultArea.innerHTML = '';
            loading.classList.remove('hidden');

            try {
                // é€£ç·šåˆ°èŒå…¸å®¢èª API (è§£æ±ºæ”¿åºœç¶²ç«™ CORS å•é¡Œçš„é—œéµ)
                const response = await fetch(`https://www.moedict.tw/hakka/${input}.json`);
                
                if (!response.ok) {
                    throw new Error("æŸ¥ç„¡æ­¤è©");
                }

                const data = await response.json();
                displayResult(data, input);

            } catch (error) {
                resultArea.innerHTML = `
                    <div class="error-card">
                        <h3>ğŸ˜¢ æ‰¾ä¸åˆ°ã€Œ${input}ã€</h3>
                        <p>å¯èƒ½æ˜¯é€™å€‹è©å¤ªæ–°ï¼Œæˆ–æ˜¯å­—å…¸è£¡æ²’æœ‰æ”¶éŒ„ã€‚<br>è©¦è©¦çœ‹æœå°‹åˆ¥çš„è©ï¼Ÿ</p>
                    </div>
                `;
            } finally {
                loading.classList.add('hidden');
            }
        }

        // é¡¯ç¤ºçµæœçš„é‚è¼¯
        function displayResult(data, keyword) {
            const resultArea = document.getElementById('resultArea');
            
            // èŒå…¸çš„è³‡æ–™çµæ§‹æ¯”è¼ƒè¤‡é›œï¼Œæˆ‘å€‘éœ€è¦æŠŠä¸åŒè…”èª¿æŠ“å‡ºä¾†
            // h = heteronyms (å¤šéŸ³å­—/ä¸åŒè®€éŸ³)
            let htmlContent = `<h2>ã€Œ${keyword}ã€çš„å®¢èªçµæœï¼š</h2>`;

            if(data.h) {
                data.h.forEach((item, index) => {
                    // å»ºç«‹ç™¼éŸ³å¡ç‰‡
                    let pinyin = item.p || "ç„¡æ‹¼éŸ³è³‡æ–™";
                    // å˜—è©¦è½‰æ›è…”èª¿ä»£è™Ÿç‚ºä¸­æ–‡åç¨± (å››ç¸£ã€æµ·é™¸ç­‰)
                    // èŒå…¸æ ¼å¼é€šå¸¸å°‡è…”èª¿å¯«åœ¨æ‹¼éŸ³è£¡ï¼Œé€™è£¡åšç°¡å–®å‘ˆç¾
                    
                    let definitions = item.d || [];
                    let defHtml = definitions.map(d => `<li>${d.f}</li>`).join('');

                    htmlContent += `
                        <div class="result-card">
                            <div class="pinyin-box">
                                <span class="label">ç™¼éŸ³/æ‹¼éŸ³</span>
                                <div class="pinyin-text">${pinyin}</div>
                            </div>
                            <div class="definition-box">
                                <span class="label">é‡‹ç¾©</span>
                                <ul>${defHtml}</ul>
                            </div>
                        </div>
                    `;
                });
            }

            resultArea.innerHTML = htmlContent;
        }

        // è®“æŒ‰ Enter éµä¹Ÿèƒ½æœå°‹
        document.getElementById("searchInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                searchHakka();
            }
        });
    </script>
</body>
</html>